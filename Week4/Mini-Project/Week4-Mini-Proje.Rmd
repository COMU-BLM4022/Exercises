---
title: "Hava Kalitesi Veri Analizi"
output:
  html_document:
    df_print: paged
---

T.C. Çevre Şehircilik ve İklim Değişikliği bakanlığının ülke genelinde yaptığı hava kalitesi
ölçümleri [https://sim.csb.gov.tr/Services/AirQuality](https://sim.csb.gov.tr/Services/AirQuality) adresinde bulunan web uygulamasında istasyon bazında görsellenebilmektedir. 

Ham veriler ise [https://sim.csb.gov.tr/STN/STN_Report/StationDataDownloadNew](https://sim.csb.gov.tr/STN/STN_Report/StationDataDownloadNew) adresinden *Excel* formatında indirlebilmektedir. 

## Veri ithali

Istanbul Maslak'a ait olan saatlik hava kalitesi parametrelerini Excel formatında Şubat-Mart ayı için indirdim.

```{r warning=FALSE}
library(readxl)
havaK <- readxl::read_excel("ornek_veri_1.xlsx", skip = 1, col_names = c("Tarih", "Istanbul Maslak", "PM2.5", "SO2", "CO","NO2","NOX","NO","O3"))
head(havaK, 10)
```

## Veri Kalite Kontrolü

### Zaman sütunu
Zaman değerlerini içeren sütunun isminin **Time** olması
```{r}
# tarih sütunun adını time olarak değiştirme 
names(havaK)[1] <- "Time"
```


*havaK$Time* adlı değişkendeki bütün verilerin **POSIXct** tipinde olmasını sağladım 

```{r}
# havaK$Time sütununu POSIXct türüne dönüştürme
havaK$Time <- as.POSIXct(havaK$Time)
```

*Time* sütunu dışındaki bütün sütunların tipinin **numeric** olmasını sağladım.

```{r message=FALSE, warning=FALSE}
library(dplyr)

# Tüm sütunların tipini numeric yapma (ilk sütun hariç)
havaK <- havaK %>%
  mutate(across(-1, ~as.numeric(gsub(",", ".", .))))
# İlk satırı çıkartma
havaK <- havaK[-1, ]
head(havaK, 10)
```

## Egzersiz 3 - Veri Görselleme

Dygraphs paketini kullanarak NO2 ve SO2 değerlerinin zaman serisi grafiğini oluşturdum.




```{r warning=FALSE}
# dygraphs paketini yükleyin
library(dygraphs)

# Tarih sütununun adını "time" olarak değiştirme
names(havaK)[names(havaK) == "Tarih"] <- "Time"

# Tarih sütununu uygun bir formata dönüştürme
havaK$Time <- as.POSIXct(havaK$Time, format = "%d.%m.%Y %H:%M:%S")

# 'xts' nesnesini oluşturma
havaK_ts <- xts::xts(havaK[, -1], order.by = havaK$Time)

# İki farklı parametre için ayrı ayrı zaman serileri oluşturma
no2_obj <- havaK_ts$NO2
so2_obj <- havaK_ts$SO2

# dygraph grafiğini oluşturma
dygraph(cbind(no2_obj, so2_obj), main = "NO2 ve SO2 Degerlerinin Zaman Serisi Grafiği") %>%
  dyAxis("y", label = "NO2", axisLabelColor = "blue") %>%
  dyAxis("y2", label = "SO2", axisLabelColor = "red") %>%
  dyOptions(colors = c("blue", "red")) %>%
  dySeries("SO2", axis = "y2")


```